/* BUILD_VERSION '2025.3.1' */
/* BUILD_TIMESTAMP '20250304-131721' */
(()=>{"use strict";function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,n(i.key),i)}}function e(t,e,r){return(e=n(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function n(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var r=function(t){return t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t}(r||{});const i=new(function(){function n(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),e(this,"_logLevel",r.WARN),e(this,"isEmbeddedMode",void 0),e(this,"console",window.console),e(this,"dummy",(function(){})),e(this,"error",this.dummy),e(this,"warn",this.dummy),e(this,"info",this.dummy),e(this,"debug",this.dummy),this.isEmbeddedMode=this._inIframe(),this.setLogLevel(this.getLogLevelConfig())}var i,o,a;return i=n,(o=[{key:"_inIframe",value:function(){try{return window.self!==window.top}catch(t){return!0}}},{key:"_messagePrefix",value:function(){return this.isEmbeddedMode?"[epaas-onlineaudit-embedded]":"[epaas-onlineaudit]"}},{key:"getLogLevelConfig",value:function(){var t=window.location.search+"-"+window.location.hash+"-"+document.cookie;return t.includes("epaas.logger=NONE")?r.NONE:t.includes("epaas.logger=ERROR")?r.ERROR:t.includes("epaas.logger=WARN")?r.WARN:t.includes("epaas.logger=INFO")?r.INFO:t.includes("epaas.logger=DEBUG")?r.DEBUG:this._logLevel}},{key:"setLogLevel",value:function(t){var e=this._messagePrefix();this.error=t>=r.ERROR?this.console.error.bind(this.console,e+" - ERROR - %s"):this.dummy,this.warn=t>=r.WARN?this.console.warn.bind(this.console,e+" - WARN  - %s"):this.dummy,this.info=t>=r.INFO?this.console.info.bind(this.console,e+" - INFO  - %s"):this.dummy,this.debug=t>=r.DEBUG?this.console.log.bind(this.console,e+" - DEBUG - %s"):this.dummy,this._logLevel=t}},{key:"isErrorEnabled",value:function(){return this._logLevel>=r.ERROR}},{key:"isWarnEnabled",value:function(){return this._logLevel>=r.WARN}},{key:"isInfoEnabled",value:function(){return this._logLevel>=r.INFO}},{key:"isDebugEnabled",value:function(){return this._logLevel>=r.DEBUG}}])&&t(i.prototype,o),a&&t(i,a),Object.defineProperty(i,"prototype",{writable:!1}),n}());function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u(r.key),r)}}function a(t,e,n){return(e=u(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var c=function(t){return t.EVENT_INITIALIZED="onlineaudit.api.initialized",t}({});const s=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"initialized",!1),a(this,"initializeFailed",!1),a(this,"eventListeners",[])}var e,n,r;return e=t,(n=[{key:"addEventListener",value:function(t,e){if(t)if(e){if(t===c.EVENT_INITIALIZED){if(this.initialized)return void this.wrapCallBack(e,this.createInitializedEvent(this));if(this.initializeFailed)return void this.wrapCallBack(e,this.createInitializedEvent(void 0))}this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(e)}else i.warn("addEventListener: eventCallback should not be null.");else i.warn("addEventListener: eventType should not be empty or null.")}},{key:"removeEventListener",value:function(t,e){if(t)if(e){var n=this.eventListeners[t];if(n)for(var r=n.length-1;r>=0;r--)n[r]===e&&n.splice(r,1)}else i.warn("removeEventListener: eventCallback should not be null.");else i.warn("removeEventListener: eventType should not be empty or null.")}},{key:"triggerApiInitializedEvent",value:function(){var t;this.setInitialized(!0),t=window.epaas.onlineaudit&&window.epaas.onlineaudit.api?this.createInitializedEvent(window.epaas.onlineaudit.api):this.createInitializedEvent(this),i.debug("initialization ok - delivering api in initialized event",t),this.dispatchEvent(c.EVENT_INITIALIZED,t)}},{key:"wrapCallBack",value:function(t,e){try{t(e)}catch(t){i.warn("caught exception while executing addEventListener callback",t)}}},{key:"createInitializedEvent",value:function(t){return this.createEvent(c.EVENT_INITIALIZED,t)}},{key:"createEvent",value:function(t,e){try{return new CustomEvent(t,{detail:e})}catch(r){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,{detail:e}),n}}},{key:"setInitialized",value:function(t){this.initializeFailed?this.initialized=!1:this.initialized=t}},{key:"dispatchEvent",value:function(t,e){var n=this.eventListeners[t];if(n)for(var r=n.map((function(t){return t})),o=0;o<r.length;o++)try{r[o](e)}catch(t){i.warn("caught exception while executing dispatchEvent callback",t)}try{window.dispatchEvent(e)}catch(t){i.warn("caught exception while executing window.dispatchEvent",t)}}},{key:"fireInitFailedEvent",value:function(){this.setInitialized(!1),this.setInitializeFailed(!0);var t=this.createInitializedEvent(void 0);i.info("initialization failed - firing empty initialized event",t),this.dispatchEvent(c.EVENT_INITIALIZED,t)}},{key:"setInitializeFailed",value:function(t){this.initializeFailed=t}}])&&o(e.prototype,n),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());function l(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */l=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),u=new T(r||[]);return i(a,"_invoke",{value:L(t,n,u)}),a}function v(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",p="suspendedYield",y="executing",d="completed",g={};function m(){}function b(){}function w(){}var E={};s(E,a,(function(){return this}));var k=Object.getPrototypeOf,x=k&&k(k(B([])));x&&x!==n&&r.call(x,a)&&(E=x);var O=w.prototype=m.prototype=Object.create(E);function j(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(i,o,a,u){var c=v(t[i],t,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function L(e,n,r){var i=h;return function(o,a){if(i===y)throw new Error("Generator is already running");if(i===d){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var u=r.delegate;if(u){var c=S(u,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=y;var s=v(e,n,r);if("normal"===s.type){if(i=r.done?d:p,s.arg===g)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(i=d,r.method="throw",r.arg=s.arg)}}}function S(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=v(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function B(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return b.prototype=w,i(O,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=s(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,s(t,c,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},j(P.prototype),s(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new P(f(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},j(O),s(O,c,"Generator"),s(O,a,(function(){return this})),s(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=B,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return u.type="throw",u.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],u=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:B(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function f(t,e,n,r,i,o,a){try{var u=t[o](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,i)}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,h(r.key),r)}}function h(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var p=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r,o,a;return e=t,n=[{key:"getData",value:(o=l().mark((function t(e){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:if((n=t.sent).ok){t.next=6;break}throw new Error("Error: "+n.status+" "+n.statusText);case 6:return t.next=8,n.json();case 8:return t.abrupt("return",t.sent);case 11:t.prev=11,t.t0=t.catch(0),i.info("Fetch error:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})),a=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){f(i,n,r,a,u,"next",t)}function u(t){f(i,n,r,a,u,"throw",t)}a(void 0)}))},function(t){return a.apply(this,arguments)})},{key:"postData",value:function(t,e){fetch(t,{method:"POST",body:JSON.stringify(e)}).catch((function(t){i.info("Post error:",t)}))}}],n&&v(e.prototype,n),r&&v(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,g(r.key),r)}}function d(t,e,n){return(e=g(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function m(){var t=document.currentScript;if(t)return t;var e=document.getElementsByTagName("script");return e[e.length-1]}var b=new(function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,"config",void 0),d(this,"publicPath",void 0),d(this,"currentScriptApiVersion",void 0),this.config=null,this.publicPath=e,this.currentScriptApiVersion=n}var e,n,r;return e=t,(n=[{key:"initialize",value:function(t){this.config=t}},{key:"getPublicPath",value:function(){return this.publicPath}},{key:"getCurrentScriptApiVersion",value:function(){return this.currentScriptApiVersion}},{key:"activationProbability",get:function(){var t,e,n,r;return null!=(t=this.config)&&null!=(e=t.config)&&e.activationProbability?null==(n=this.config)||null==(r=n.config)?void 0:r.activationProbability:0}},{key:"queueFilter",get:function(){var t,e;return null==(t=this.config)||null==(e=t.config)?void 0:e.queueFilter}},{key:"queuesSpecification",get:function(){var t;return null==(t=this.config)?void 0:t.queuesSpecification}},{key:"frontendBatchIntervalSecs",get:function(){var t,e,n,r;return null!=(t=this.config)&&null!=(e=t.config)&&e.frontendBatchIntervalSecs?null==(n=this.config)||null==(r=n.config)?void 0:r.frontendBatchIntervalSecs:30}},{key:"frontendBatchSize",get:function(){var t,e,n,r;return null!=(t=this.config)&&null!=(e=t.config)&&e.frontendBatchSize?null==(n=this.config)||null==(r=n.config)?void 0:r.frontendBatchSize:20}}])&&y(e.prototype,n),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}())(function(){var t=m();if(t){var e=document.createElement("a");return e.href=t.src,"localhost"===e.hostname?e.protocol+"//"+e.hostname+":3003/":e.origin?e.origin+"/":e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")+"/"}return"/"}(),function(){var t=m();if(!t)return"";var e=t.getAttribute("src"),n=e?e.match(/onlineaudit-(\d+\.\d+\.\d+)\.js/):void 0;return n?n[1]:""}());function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function k(t,e,n){return e&&E(t.prototype,e),n&&E(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function x(t,e,n){return(e=O(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var j=function(){function t(){w(this,t),x(this,"endpoint",void 0),x(this,"http",void 0),this.http=new p,this.endpoint=b.getPublicPath()+"epaas"}return k(t,[{key:"getTimestamp",value:function(){var t=new Date,e=t.toISOString();return e.substring(0,e.indexOf(":"))+":"+this.pad2(20*Math.floor(t.getUTCMinutes()/20))+":00Z"}},{key:"pad2",value:function(t){return t<10?"0"+t:""+t}},{key:"get",value:function(t){return this.http.getData(t)}},{key:"post",value:function(t,e){this.http.postData(t,e)}}]),t}();const P=new(function(){function t(){w(this,t),x(this,"service",void 0),this.service=new j}return k(t,[{key:"getConfigByTimestamp",value:function(){var t=this.service.endpoint+"/onlineaudit/config/"+this.service.getTimestamp()+".epaas.json";return this.service.get(t)}},{key:"sendEventBatches",value:function(t){var e=this.service.endpoint+"/onlineaudit/producer/ingest-events",n=this.replaceFieldName(t);this.addField(n),this.service.post(e,n)}},{key:"addField",value:function(t){var e="r".concat("i").concat("d");t[e]=this.generateUUID();var n=t[e];delete t[e];var r=JSON.stringify(t),i=this.generateHash(r);t[e]=this.formatLeastSigBits(n,i)}},{key:"generateUUID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}},{key:"generateHash",value:function(t){for(var e=t,n=0n,r=0;r<e.length;r++)n+=BigInt(e.charCodeAt(r)*r)%BigInt(Math.pow(2,64));return n}},{key:"formatLeastSigBits",value:function(t,e){var n=t.split("-"),r=e.toString("16").padStart(16,"0");return n[0]+"-"+n[1]+"-"+n[2]+"-"+r.substring(0,4)+"-"+r.substring(4)}},{key:"isFieldEmptyOrDash",value:function(t){return""===t||null===t||"-"===t}},{key:"replaceFieldName",value:function(t){var e=this,n=JSON.parse(JSON.stringify(t)),r={},i=b.queuesSpecification,o=function(t){var o=function(){var o=n[t][a];Object.keys(o).forEach((function(n){if(null!=i[t]&&null!=i[t]){var a=i[t].schema.fields.find((function(t){return t.name===n}));a&&a.shortName&&(o[a.shortName]=o[n],delete o[n]),a&&null!=a&&a.common&&a.shortName&&(a.shortName in r&&!e.isFieldEmptyOrDash(r[a.shortName])||(r[a.shortName]=o[a.shortName]),delete o[a.shortName])}}))};for(var a in n[t])o()};for(var a in n)o(a);return 0!==Object.keys(r).length&&(n.globalcommon=[r]),n}}]),t}());function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,S(r.key),r)}}function S(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var N=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,(n=[{key:"push",value:function(t){i.debug("Inactive Queue push event - will be lost",t)}}])&&L(e.prototype,n),r&&L(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,B(r.key),r)}}function T(t,e,n){return(e=B(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var A=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,"queueFilter",void 0),T(this,"queueName",void 0),T(this,"mapFilterRegexp",new Map);var r=b;if(this.queueName=e,r.queueFilter&&(this.queueFilter=r.queueFilter[e],this.queueFilter)){var i=function(){var t=[];n.queueFilter[o].forEach((function(e){return t.push(new RegExp(e))})),n.mapFilterRegexp.set(o,t)};for(var o in this.queueFilter)i()}}var e,n,r;return e=t,(n=[{key:"filter",value:function(t){var e,n=this,r=function(){var e=t[i],r=n.mapFilterRegexp.get(i);if(r&&(void 0===e||!r.some((function(t){return t.test(e)}))))return{v:!1}};for(var i in this.queueFilter)if(e=r())return e.v;return!0}}])&&I(e.prototype,n),r&&I(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_(r.key),r)}}function _(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var C=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,(n=[{key:"supports",value:function(t){return"exists"===t}},{key:"aggregateEvent",value:function(t,e){}},{key:"resetAggregatedEvent",value:function(t){}}])&&F(e.prototype,n),r&&F(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,z(r.key),r)}}function z(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var R=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,(n=[{key:"supports",value:function(t){return"count"===t}},{key:"aggregateEvent",value:function(t,e){e.count?e.count++:e.count=1}},{key:"resetAggregatedEvent",value:function(t){t.count=0}}])&&q(e.prototype,n),r&&q(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,G(r.key),r)}}function G(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var M=new(function(){function t(){var e,n,r,i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,r=void 0,(n=G(n="aggregationFunctions"))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,this.aggregationFunctions=[new C,new R],s.addEventListener("onlineaudit.internal.batchSent",(function(t){return i.resetAggregatedEvents(t.detail)}))}var e,n,r;return e=t,(n=[{key:"getEventAggregationKey",value:function(t,e){return b.queuesSpecification[e].aggregation.groupBy.map((function(e){return t[e]})).join(",")}},{key:"aggregateEvent",value:function(t,e,n){var r=b.queuesSpecification[n].aggregation.fieldOperations.action,i=this.aggregationFunctions.find((function(t){return t.supports(r)}));i&&i.aggregateEvent(t,e)}},{key:"resetAggregatedEvents",value:function(t){var e=this;for(var n in t){var r=function(){var r=t[n][o];i.info("Reset Aggregated Event for queueName [",n,"] : ",r);var a=b.queuesSpecification[n].aggregation.fieldOperations.action,u=e.aggregationFunctions.find((function(t){return t.supports(a)}));u&&u.resetAggregatedEvent(r)};for(var o in t[n])r()}}}])&&D(e.prototype,n),r&&D(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,W(r.key),r)}}function V(t,e,n){return(e=W(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function W(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var K=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),V(this,"eventBatch","onlineaudit.internal.batchSent"),V(this,"queueEventBatches",void 0),V(this,"existingEventKeys",void 0),V(this,"intervalId",void 0),this.queueEventBatches={},this.existingEventKeys=new Map,this.setupInterval(),this.setupPageUnloadHandler()}var e,n,r;return e=t,(n=[{key:"addToBatch",value:function(t,e,n){this.queueEventBatches[n]||(this.queueEventBatches[n]=[]),this.existingEventKeys.has(n)||this.existingEventKeys.set(n,new Set);var r=this.existingEventKeys.get(n);r.has(e)||(this.queueEventBatches[n].push(t),r.add(e),Object.values(this.queueEventBatches).flatMap((function(t){return t})).length>=b.frontendBatchSize&&this.sendEventBatchesToBackend())}},{key:"setupInterval",value:function(){var t=this;this.intervalId=setInterval((function(){return t.sendEventBatchesToBackend()}),1e3*b.frontendBatchIntervalSecs)}},{key:"resetInterval",value:function(){clearInterval(this.intervalId),this.setupInterval()}},{key:"sendEventBatchesToBackend",value:function(){try{i.info("sendEventBatchesToBackend checking if there are events to send");var t=Object.values(this.queueEventBatches).flat().length;if(t>0){i.info("sendEventBatchesToBackend Sending event batch [",t,"]"),P.sendEventBatches(this.queueEventBatches);var e=s.createEvent(this.eventBatch,this.queueEventBatches);s.dispatchEvent(this.eventBatch,e),this.queueEventBatches={},this.existingEventKeys.clear(),this.resetInterval()}}catch(t){i.warn("failed sendEventBatchesToBackend ",t)}}},{key:"setupPageUnloadHandler",value:function(){var t=this;window.addEventListener("beforeunload",(function(){i.debug("beforeunload triggered"),t.sendEventBatchesToBackend()}))}}])&&U(e.prototype,n),r&&U(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Z(){return Z=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Z.apply(this,arguments)}function Q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,J(r.key),r)}}function H(t,e,n){return(e=J(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function J(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var Y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),H(this,"eventFilter",void 0),H(this,"queueName",void 0),H(this,"aggregatedMap",new Map),this.queueName=e,this.eventFilter=new A(e)}var e,n,r;return e=t,(n=[{key:"push",value:function(t){if(this.eventFilter.filter(t)){var e=M.getEventAggregationKey(t,this.queueName),n=this.aggregatedMap.get(e);n||(n=Z({},t),this.aggregatedMap.set(e,n)),M.aggregateEvent(t,n,this.queueName),K.addToBatch(n,e,this.queueName),i.info("Active Queue [",this.queueName,"] push object ",t,n)}}}])&&Q(e.prototype,n),r&&Q(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function $(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function tt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */tt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,a=Object.create(o.prototype),u=new I(r||[]);return i(a,"_invoke",{value:P(t,n,u)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var v="suspendedStart",h="suspendedYield",p="executing",y="completed",d={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var E=Object.getPrototypeOf,k=E&&E(E(T([])));k&&k!==n&&r.call(k,a)&&(w=k);var x=b.prototype=g.prototype=Object.create(w);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function n(i,o,a,u){var c=f(t[i],t,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,u)}))}u(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function P(e,n,r){var i=v;return function(o,a){if(i===p)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var u=r.delegate;if(u){var c=L(u,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===v)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var s=f(e,n,r);if("normal"===s.type){if(i=r.done?y:h,s.arg===d)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(i=y,r.method="throw",r.arg=s.arg)}}}function L(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=f(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,d;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function T(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return m.prototype=b,i(x,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new j(l(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return u.type="throw",u.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],u=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}function et(t,e,n,r,i,o,a){try{var u=t[o](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,i)}function nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,rt(r.key),r)}}function rt(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var it=new(function(){function t(){var e,n,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,r=void 0,(n=rt(n="settings"))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,i.info("Start OnlineAuditApi"),this.settings=b,this.initialize()}var e,n,r,o,a;return e=t,n=[{key:"initialize",value:(o=tt().mark((function t(){var e;return tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,P.getConfigByTimestamp();case 3:if(e=t.sent){t.next=6;break}throw new Error("Error getting config");case 6:this.settings.initialize(e),s.triggerApiInitializedEvent(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),i.info("ePaas-onlineaudit Initialization failed:",t.t0),s.fireInitFailedEvent();case 14:case"end":return t.stop()}}),t,this,[[0,10]])})),a=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){et(i,n,r,a,u,"next",t)}function u(t){et(i,n,r,a,u,"throw",t)}a(void 0)}))},function(){return a.apply(this,arguments)})},{key:"connect",value:function(t){i.debug("Connecting...");var e=this.checkVersionCompatibility(),n=this.checkActivationProbability();if(e&&n){for(var r in t){var o=t[r];if(Array.isArray(o)){for(var a,u=new Y(r),c=$(o);!(a=c()).done;){var s=a.value;u.push(s)}t[r]=u}else o instanceof Y||(t[r]=new Y(r))}i.debug("Online-Audit Api connected")}else i.debug("Online-Audit Api did not connect: versionCheck "+e+", activationProbabilityCheck "+n),this.inactivateQueues(t)}},{key:"checkActivationProbability",value:function(){return 100*Math.random()<this.settings.activationProbability}},{key:"checkVersionCompatibility",value:function(){var t,e=!0;return(null==(t=this.settings.config)?void 0:t.apiVersion)!==this.getCurrentScriptApiVersion()&&(e=!1),e}},{key:"disconnect",value:function(t){i.debug("Disconnecting..."),this.inactivateQueues(t),K.sendEventBatchesToBackend()}},{key:"inactivateQueues",value:function(t){for(var e in t)t[e]=new N}},{key:"addEventListener",value:function(t,e){s.addEventListener(t,e)}},{key:"removeEventListener",value:function(t,e){s.removeEventListener(t,e)}},{key:"getCurrentScriptApiVersion",value:function(){return this.settings.getCurrentScriptApiVersion()}}],n&&nt(e.prototype,n),r&&nt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());window.epaas=window.epaas||{},window.epaas.onlineaudit=window.epaas.onlineaudit||{},window.epaas.onlineaudit.api=it})();